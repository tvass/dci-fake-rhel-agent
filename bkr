#!/bin/sh
touch /tmp/dci-fake-rhel-agent.job

case "$1" in
"job-results")
    JOB_ID=`head -n1 /tmp/dci-fake-rhel-agent.job`
    if [[ -n ${JOB_ID} ]]
    then   
cat << EOF
<job id="${JOB_ID}" owner="distributed-ci@redhat.com" result="Pass" status="Completed" retention_tag="scratch"><whiteboard></whiteboard><recipeSet priority="Normal" response="ack" id="${JOB_ID}"><recipe id="${JOB_ID}" job_id="${JOB_ID}" recipe_set_id="${JOB_ID}" whiteboard="" role="None" kickstart_url="http://dvssc-dci-dir01/bkr/kickstart/20" ks_meta="selinux=--permissive autopart_type=plain harness='restraint beakerlib'" kernel_options="" kernel_options_post="" start_time="2019-02-12 21:32:23"
finish_time="2019-02-12 21:50:48" duration="0:18:25" result="Pass" status="Completed" distro="Red Hat Enterprise Linux 7.6" arch="x86_64" family="RedHatEnterpriseLinux7" variant="Server" system="dvssc-dci-vt001"><autopick random="false"/><watchdog/><installation install_started="2019-02-12 21:33:12" install_finished="2019-02-12 21:38:28" postinstall_finished="2019-02-12 21:38:41"/><packages/><ks_appends/><roles><role value="None"><system value="dvssc-dci-vt001"/></role></roles><repos/><distroRequires>
                <and>
                    <distro_name op="=" value="Red Hat Enterprise Linux 7.6"/>
                    <distro_arch op="=" value="x86_64"/>
                </and>
            </distroRequires><hostRequires><system_type value="Machine"/></hostRequires><partitions/><logs><log href="http://dvssc-dci-dir01/bkr/recipes/${JOB_ID}/logs/anaconda.log" name="anaconda.log"/><log href="http://dvssc-dci-dir01/bkr/recipes/${JOB_ID}/logs/sys.log" name="sys.log"/><log href="http://dvssc-dci-dir01/bkr/recipes/${JOB_ID}/logs/storage.log" name="storage.log"/><log href="http://dvssc-dci-dir01/bkr/recipes/${JOB_ID}/logs/program.log" name="program.log"/><log href="http://dvssc-dci-dir01/bkr/recipes/${JOB_ID}/logs/ks.cfg" name="ks.cfg"/><log href="http://dvssc-dci-dir01/bkr/recipes/${JOB_ID}/logs/ifcfg.log" name="ifcfg.log"/><log href="http://dvssc-dci-dir01/bkr/recipes/${JOB_ID}/logs/packaging.log" name="packaging.log"/><log href="http://dvssc-dci-dir01/bkr/recipes/${JOB_ID}/logs/boot.log" name="boot.log"/><log href="http://dvssc-dci-dir01/bkr/recipes/${JOB_ID}/logs/messages" name="messages"/><log href="http://dvssc-dci-dir01/bkr/recipes/${JOB_ID}/logs/dmesg" name="dmesg"/></logs><task name="/distribution/install" role="STANDALONE" version="1.12-2" id="43" result="Pass" status="Completed" avg_time="1200" start_time="2019-02-12 21:49:25" finish_time="2019-02-12 21:50:09" duration="0:00:44"><rpm name="beaker-distribution-install" path="/mnt/tests/distribution/install"/><roles><role value="STANDALONE"><system value="dvssc-dci-vt001"/></role></roles><logs><log href="http://dvssc-dci-dir01/bkr/recipes/${JOB_ID}/tasks/43/logs/harness.log" name="harness.log"/><log href="http://dvssc-dci-dir01/bkr/recipes/${JOB_ID}/tasks/43/logs/taskout.log" name="taskout.log"/><log href="http://dvssc-dci-dir01/bkr/recipes/${JOB_ID}/tasks/43/logs/anaconda-ks.cfg" name="anaconda-ks.cfg"/><log href="http://dvssc-dci-dir01/bkr/recipes/${JOB_ID}/tasks/43/logs/boot.messages" name="boot.messages"/><log href="http://dvssc-dci-dir01/bkr/recipes/${JOB_ID}/tasks/43/logs/procmem.log" name="procmem.log"/></logs><results><result path="/distribution/install/CheckRecipe" start_time="2019-02-12 21:50:04" score="None" result="Pass" id="79">None<logs><log href="http://dvssc-dci-dir01/bkr/recipes/${JOB_ID}/tasks/43/results/79/logs/dmesg.log" name="dmesg.log"/><log href="http://dvssc-dci-dir01/bkr/recipes/${JOB_ID}/tasks/43/results/79/logs/avc.log" name="avc.log"/><log href="http://dvssc-dci-dir01/bkr/recipes/${JOB_ID}/tasks/43/results/79/logs/resultoutputfile.log" name="resultoutputfile.log"/></logs></result><result path="/distribution/install" start_time="2019-02-12 21:50:05" score="655" result="Pass" id="80">None<logs><log href="http://dvssc-dci-dir01/bkr/recipes/${JOB_ID}/tasks/43/results/80/logs/avc.log" name="avc.log"/><log href="http://dvssc-dci-dir01/bkr/recipes/${JOB_ID}/tasks/43/results/80/logs/resultoutputfile.log" name="resultoutputfile.log"/></logs></result><result path="/distribution/install/Sysinfo" start_time="2019-02-12 21:50:08" score="2000000" result="Pass" id="81">None<logs><log href="http://dvssc-dci-dir01/bkr/recipes/${JOB_ID}/tasks/43/results/81/logs/avc.log" name="avc.log"/><log href="http://dvssc-dci-dir01/bkr/recipes/${JOB_ID}/tasks/43/results/81/logs/resultoutputfile.log" name="resultoutputfile.log"/></logs></result></results></task><task name="/distribution/reservesys" role="None" version="3.4-10" id="44" result="Pass" status="Completed" avg_time="86400" start_time="2019-02-12 21:50:09" finish_time="2019-02-12 21:50:32" duration="0:00:23"><rpm name="beaker-distribution-reservesys" path="/mnt/tests/distribution/reservesys"/><roles><role value="None"><system value="dvssc-dci-vt001"/></role></roles><logs><log href="http://dvssc-dci-dir01/bkr/recipes/${JOB_ID}/tasks/44/logs/harness.log" name="harness.log"/><log href="http://dvssc-dci-dir01/bkr/recipes/${JOB_ID}/tasks/44/logs/taskout.log" name="taskout.log"/></logs><results><result path="/distribution/reservesys" start_time="2019-02-12 21:50:12" score="0" result="Pass" id="82">None<logs><log href="http://dvssc-dci-dir01/bkr/recipes/${JOB_ID}/tasks/44/results/82/logs/avc.log" name="avc.log"/><log href="http://dvssc-dci-dir01/bkr/recipes/${JOB_ID}/tasks/44/results/82/logs/resultoutputfile.log" name="resultoutputfile.log"/></logs></result><result path="exit_code" start_time="2019-02-12 21:50:32" score="0" result="Pass" id="83">None</result></results></task></recipe></recipeSet></job>         
EOF
sed -i '1d' /tmp/dci-fake-rhel-agent.job
    else
        echo "No running"
    fi
    ;;
"job-submit") 
    JOB_ID=$(( ( RANDOM % 100 )  + 1 ))
    echo ${JOB_ID} >> /tmp/dci-fake-rhel-agent.job
    echo "{J:${JOB_ID}}"
    ;;
esac